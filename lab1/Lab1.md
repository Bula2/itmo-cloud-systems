
# Лабораторная работа №1 "Работа с Dockerfile"

## Выполнили: 
Булаев Дмитрий K34211, Мелких Дмитрий K34211

## Цель работы:
Написать два Dockerfile - плохой и хороший.

## Задачи:
* Написать плохой Dockerfile и описать плохие практики, которые в нем используются
* Написать хороший Dockerfile, где будут исправлены плохие практики
* Описать две плохие практики по использованию созданного контейнера  

## Ход работы

### Dockerfile_bad

В первую очередь создадим файл Dockerfile_bad, в котором опишем работающие, но при этом не самые лучшие практики реализации Dockerfile.

1.  В плохом Dockerfile используется исходный образ Ubuntu c тегом latest. Это может быть плохой практикой, так как в последней версии Ubuntu, которая будет на момент сборки контейнера, может не поддерживаться исполняемый файл или приложение, которое используется внутри образа. Так же сам образ Ubuntu довольно большой и имеет большое количество ненужных для нашей текущей задачи утилит, а потому в нашем случаее можно было бы ограничиться более легковесным образом (подробнее в Dockerfile_good).

```
FROM ubuntu:latest
```

2. Использовать несколько команд ADD, вместо объединения их в одну. Инструкции создают новый слой контейнера, а потому группировка нескольких команд вместе уменьшит количество слоев.

```
RUN apt-get update
RUN apt-get install -y python3
```

3. Контейнер выполняется с правами root, что может представлять риск с точки зрения безопасности. Лучше создать нового пользователя и назначить ему необохдимы права.

4. Использовать CMD, вместо ENTRYPOINT. На самом деле это является плохой практикой только в нашем случае, так при использовании инструкции CMD можно изменить исполняемый файл, который запускается при запуске контейнера. При использовании ENTRYPOINT этого сделать нельзя. Нам же не нужно, чтобы исполняемый файл менялся, а потому CMD будет не лучшем решением.

```
CMD ["python3", "app.py"]
```

* Запуск "плохого контейнера"

### Dockerfile_good

Теперь попробуем создать Dockerfile_good в котором исправим плохие практики.

1. Будем использовать в качестве исходного образа python:3.8-slim. Тут и версия указана конкретная, и сам образ меньше, но при этом все необходимые нам функции сохраняются.

```
FROM python:3.8-slim
```

2. Объединим все команды ADD в одну, дабы не плодить лишние слои.

```
RUN apt-get update && \
    apt-get install -y python3 && \
    useradd -m dmitrii
```

3. Создадим нового пользователя, от лица которого будем запускать исполняемый файл.

```
RUN useradd -m dmitrii
USER dmitrii
```

4. Используем интсрукцию ENTRYPOINT вместо CMD.

```
ENTRYPOINT ["python3", "app.py"]
```

* Запуск хорошего контейнера.

### Плохие практики по использованию контейнера

1. Запуск контейнера без задаваимого имени (через --name). В таком случае Docker даст контейнеру произвольное название, что может запутать во время работы.

2. Открытие лишних портов. Рекомендуется оставлять открытыми только порты, которые действительно нужны приложениям и избегать таких портов как SSH (22). В нашем же случае открытие портов не требуется вовсе.

3. Запуск контейнера с привилегиями root, если это не обязательно, является плохой практикой. Лучше создавать и запускать контейнеры от имени не root-пользователей.


## Вывод:
В ходе лабораторной работы были созданы два Dockerfile: плохой, с использованием плохих практики, и хороший, где эти плохие практики были исправлены. Также были описаны плохие практики по использованию созданных контейнеров. Оба контейнера были успешно созданы и запущены. В ходе выполнения лабораторной работы проблем не возникло